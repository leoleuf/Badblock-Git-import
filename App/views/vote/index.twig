{% extends 'default.twig' %}
{% set active_page = "voter" %}
{% set title = 'Voter'|trans %}
{% set sub_title = ''|trans~user.username %}
{% set description = "Vote gratuitement pour le serveur BadBlock et gagne de nombreuses récompenses gratuitement. Cette action est très rapide." %}
{% set show_title = false %}
{% block cover %}
    <!------Cover------>
    <div class="cover-back">
        <div class="cover">
            <div class="container">
                <div class="one-half column">
                    <h4 class="cover-heading">Votez pour soutenir le serveur !</h4>
                </div>
            </div>
        </div>
    </div>
    <!------Cover fin------>
{% endblock %}
{% block skyscrapers %}

    <div class="pub-skyscraper-left">
        <ins class="adsbygoogle" style="width:300px;height:600px" data-ad-client="ca-pub-1905923613312160" data-ad-slot="3319544517"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="pub-skyscraper-right">
        <ins class="adsbygoogle" style="display:inline-block;width:300px;height:600px" data-ad-client="ca-pub-1905923613312160" data-ad-slot="3319544517"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
{% endblock %}
{% block content %}
    <section>
        <div class="vote">
            <div class="nothing">
                <div class="alert alert-primary" role="alert">
                    Les probabilités de gagner l'Accès à l'HyperFarm du Nouveau SkyBlock sont doublés en votant, en ce début de mois. Profite-en dès maintenant en votant et en ouvrant ta clé au coffre du nouveau SkyBlock !
                </div>
                <div class="alert alert-error" role="alert" id="err-alert" style="display: none; text-align: center; font-size: 19px;">
                </div>
                <div class="alert alert-success" role="alert" id="success-alert" style="display: none; text-align: center; font-size: 19px;">
                </div>
                <div id="step1" class="step step-two four columns">
                    <center><h3 class="step-round">I</h3>
                        <div class="step-contains">
                            <h5 class="text-center">Entrez votre pseudo</h5>
                            <input type="text" id="pseudo" name="pseudo" value="{{ player }}"><br>
                            <a class="button button-primary" onclick="start()" title="Valider le vote" style="width: 95%;">Valider</a>
                        </div>
                    </center>
                </div>
                <div id="step2" class="step step-first four columns disabled">
                    <center><h3 class="step-round">II</h3>
                        <div class="step-contains">
                            <h5 class="text-center">Choisissez un Site</h5>
                            <a title="Choisir le site" class="button button-primary" id="btm-msf" onclick="vote('/vote/redirect')" rel="nofollow" target="_blank" style="width: 95%;">Serveur-Prive.net (1H30)</a>
                            {% if (eula == 'true') or (country == 'FR') %}
                            <a title="Liste des serveur minecraft" class="button button-primary" id="btm-msf" href="https://serveur-minecraft.net/minecraft/badblock" target="_blank" style="width: 95%;">Serveur Minecraft (1H30)</a>
                            {% endif %}
                            <div id="pleasewait" style="display: none;">

                            </div>
                        </div>
                    </center>
                </div>
                <div class="step step-three four columns">
                    <center><h3 class="step-round">III</h3>
                        <div class="step-contains">
                            <h5 class="text-center">Obtenez votre récompense</h5>
                            <div class="tooltip">
                                <button class="button button-primary disabled" id="lot2" onclick="award('6')" href="" style="width: 95%;">
                                    Nouveau SkyBlock
                                </button>
                            </div>
                            <div class="tooltip">
                                <button class="button button-primary disabled" id="lot1" onclick="award('1')" href="" style="width: 95%;">
                                    Points Boutique
                                </button>
                            </div>
                            <div class="tooltip">
                                <button class="button button-primary disabled" id="lot3" onclick="award('3')" href="" style="width: 95%;">
                                    Mini-jeux
                                </button>
                            </div>
                            <div class="tooltip">
                                <button class="button button-primary disabled" id="lot4" onclick="award('4')" href="" style="width: 95%;">
                                    Faction
                                </button>
                            </div>
                            <div class="tooltip">
                                <button class="button button-primary disabled" id="lot5" onclick="award('5')" href="" style="width: 95%;">
                                    PvpBox
                                </button>
                            </div>
                        </div>
                    </center>
                </div>
                <!--<h3 class="text-center">Loterie</h3>
                <p id="demo"></p>
                <script>
                    // Set the date we're counting down to
                    var countDownDate = 1537027800000;

                    // Update the count down every 1 second
                    var x = setInterval(function() {

                        // Get todays date and time
                        var now = new Date().getTime();

                        // Find the distance between now and the count down date
                        var distance = countDownDate - now;

                        // Time calculations for days, hours, minutes and seconds
                        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                        // Display the result in the element with id="demo"
                        document.getElementById("demo").innerHTML = "  <a class='button button-primary' title='Temps de tirage' href=''>Prochain tirage : dans " + hours + " heures "
                            + minutes + " minutes " + seconds + " secondes </a>";

                        // If the count down is finished, write some text
                        if (distance < 0) {
                            clearInterval(x);
                            document.getElementById("demo").innerHTML = "Tirage en cours...";
                        }
                    }, 1000);
                </script>
                <a class='button button-danger' title='Dernier gagnant du tirage' href=''>Dernier gagnant : xiroth57 </a><br />
                <a class='button button-success' title='Temps de tirage' href=''>Prochain lot : Grade MVP+ Temporaire </a>
                <h3 class="text-center">Probabilité de gagner à la loterie</h3>
                <div class="vote-tr">
                    <table class="votes">
                        <thead>
                        <tr>
                            <td>Rang</td>
                            <td>Joueur</td>
                            <td>Votes</td>
                        </tr>
                        </thead>
                        <tbody>
                        {% if count(toploterie) > 0 %}
                            {% for k,data in toploterie %}
                                <tr class="votes-{{ k + 1 }}">
                                    <td><span>{{ k + 1 }}</span></td>
                                    <td class="img"><a href="/profile/{{ data['name'] }}" title="Profil de {{ data['name'] }}"><img src="https://cdn.badblock.fr/head/{{ data['name'] }}/16.png" class="align-middle" title="Tête de {{ data['name'] }}" alt="Tête de {{ data['name'] }}" /> <span class="align-middle"> &nbsp;{{ data['name'] }}</span></a></td>
                                    <td>{{ data['vote']|number_format(0, '', ' ') }}</td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                        </tbody>
                    </table>
                </div>!-->
            </div>
            <h3 style="display: inline-block; text-align: center;" class="text-center">Les meilleurs votants !</h3>
            <p class="text-center">Prochaine remise à zéro des votes : <span id="demo" style="display: inline;">Chargement...</span></p>
            <script>
                // Set the date we're counting down to
                var countDownDate = 1539381600000;

                // Update the count down every 1 second
                var x = setInterval(function() {

                    // Get todays date and time
                    var now = new Date().getTime();

                    // Find the distance between now and the count down date
                    var distance = countDownDate - now;

                    // Time calculations for days, hours, minutes and seconds
                    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    // Display the result in the element with id="demo"
                    document.getElementById("demo").innerHTML = " dans <b>" + hours + " heures "
                        + minutes + " minutes " + seconds + " secondes...</b>";

                    // If the count down is finished, write some text
                    if (distance < 0) {
                        clearInterval(x);
                        document.getElementById("demo").innerHTML = "Remise à zéro en cours...";
                    }
                }, 1000);
            </script>
            <div class="vote-tr">
                <table class="votes">
                    <thead>
                    <tr>
                        <td>Rang</td>
                        <td>Joueur</td>
                        <td>Récompense</td>
                        <td>Votes</td>
                    </tr>
                    </thead>
                    <tbody>
                    {% if count(top) > 0 %}
                        {% for k,data in top %}
                            <tr class="votes-{{ k + 1 }}">
                                <td><span>{{ k + 1 }}</span></td>
                                <td class="img"><a href="/profile/{{ data['name'] }}" title="Profil de {{ data['name'] }}"><img src="https://cdn.badblock.fr/head/{{ data['name'] }}/16.png" class="align-middle" title="Tête de {{ data['name'] }}" alt="Tête de {{ data['name'] }}" /> <span class="align-middle"> &nbsp;{{ data['name'] }}</span></a></td>
                                {% if k < 2 %}
                                    <td>3000 points boutique</td>
                                {% elseif k < 3 %}
                                    <td>2250 points boutique</td>
                                {% elseif k < 6 %}
                                    <td>1500 points boutique</td>
                                {% elseif k < 10 %}
                                    <td>750 points boutique</td>
                                {% elseif k < 20 %}
                                    <td>625 points boutique</td>
                                {% elseif k < 30 %}
                                    <td>250 points boutique</td>
                                {% else %}
                                    <td></td>
                                {% endif %}
                                <td>{{ data['vote']|number_format(0, '', ' ') }}</td>
                            </tr>
                        {% endfor %}
                    {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
        </div>

    </section>
    <!-- Reg Modal -->
    <div class="remodal modal-remodal" data-remodal-id="vote-user">
        <button data-remodal-action="close" class="remodal-close"></button>
        <h1>Vous devez vous enregistrer sur le Forum de BadBlock pour voter !</h1>
        <a class="button button-danger" href="https://badblock.fr/forum/inscription/" title="S'inscrire"><i class="icon-repeat"></i>S'inscrire !</a>
    </div>
    <!-- Reg modal -->
    <!-- Time Modal -->
    <div class="remodal modal-remodal" data-remodal-id="vote-time">
        <button data-remodal-action="close" class="remodal-close"></button>
        <h1 id="time-title">Vous devez attendre pour voter !</h1>
        <a class="button button-danger" data-remodal-action="close" title="Retour"><i class="icon-repeat"></i>Retour</a>
    </div>
    <!-- Time modal -->

    <!-- End Modal -->
    <div class="remodal modal-remodal" data-remodal-id="vote-end">
        <button data-remodal-action="close" class="remodal-close"></button>
        <h1>Merci de votre soutiens !</h1>
        <a class="button button-danger" href="#" title="Fermer"><i class="icon-repeat"></i>Fermer</a>
    </div>

    <!-- Info Modal -->
    <div class="remodal modal-remodal" data-remodal-id="info-modal">
        <button data-remodal-action="close" class="remodal-close"></button>
        <h1 id="title"></h1>
        <a class="button button-danger" href="#" title="Fermer"><i class="icon-closetab"></i>Fermer</a>
    </div>
    <!-- Info modal -->


    <script async>
        var type;
        var pseudo;
        var error = false;

        function start() {
            if( window.canRunAds === undefined )
            {
                $('[data-remodal-id=blc]').remodal().open();
                return;
            }
            if($('#pseudo').val() == "" || $('#pseudo').val() == null) {
            }else{
                pseudo = $('#pseudo').val();
                var request = $.ajax({
                    url: "/vote/playerexists",
                    method: "POST",
                    data: {pseudo : pseudo},
                    dataType: "html",
                    success: function (data) {
                        $("#step1").addClass("disabled");
                        $("#step2").removeClass("disabled");
                        $("#lot1").removeClass("disabled");
                        $("#lot2").removeClass("disabled");
                        $("#lot3").removeClass("disabled");
                        $("#lot4").removeClass("disabled");
                        $("#lot5").removeClass("disabled");
                        $("#pleasewait").hide();
                    }
                });

                request.fail(function( jqXHR, msg ) {
                    if(jqXHR.status == 404)
                    {
                        $("#success-alert").hide();
                        $("#err-alert").html("<i class=\"fas fa-exclamation-circle\"></i> As-tu marqué correctement le pseudo ? Il n'existe pas sur le site. Tu peux te créer un compte <a title='Inscription' target='_blank' href='https://badblock.fr/forum/inscription/'>ici</a>.");
                        $("#err-alert").show();
                        $("#pleasewait").hide();
                    }
                    else if(jqXHR.status == 405)
                    {
                        $("#step1").addClass("disabled");
                        $("#step2").removeClass("disabled");
                        $("#lot1").removeClass("disabled");
                        $("#lot2").removeClass("disabled");
                        $("#lot3").removeClass("disabled");
                        $("#lot4").removeClass("disabled");
                        $("#lot5").removeClass("disabled");
                        $("#pleasewait").html(jqXHR.responseText);
                        $("#pleasewait").show();
                    }
                });
            }
        }

        function vote(wb)
        {
            $("#lot1").removeClass("disabled");
            $("#lot2").removeClass("disabled");
            $("#lot3").removeClass("disabled");
            $("#lot4").removeClass("disabled");
            $("#lot5").removeClass("disabled");
            window.open(wb, '_blank');
            $("#step2").addClass("disabled");
            setTimeout(function () {
                $("#pleasewait").hide();
            }, 5000);
        }

        function award(type) {
            $("#lot1").addClass("disabled");
            $("#lot2").addClass("disabled");
            $("#lot3").addClass("disabled");
            $("#lot4").addClass("disabled");
            $("#lot5").addClass("disabled");

            var request = $.ajax({
                url: "/vote/award",
                method: "POST",
                data: {
                    pseudo : pseudo,
                    type : type
                },
                dataType: "html",
                success: function (data) {
                    $("#pleasewait").hide();

                    $("#err-alert").hide();
                    $("#success-alert").html("<i class=\"fas fa-check-circle\"></i> " + data);
                    $("#success-alert").show();
                }
            });

            request.fail(function( jqXHR, msg ) {
                if(jqXHR.status == 404){
                    $("#success-alert").hide();
                    $("#err-alert").html("<i class=\"fas fa-exclamation-circle\"></i> As-tu marqué correctement le pseudo ? Il n'existe pas sur le site. Tu peux te créer un compte <a title='Inscription' target='_blank' href='https://badblock.fr/forum/inscription/'>ici</a>.");
                    $("#err-alert").show();
                    $("#pleasewait").hide();
                }else if (jqXHR.status == 405){
                    $("#success-alert").hide();
                    $("#err-alert").html(jqXHR.responseText);
                    $("#err-alert").show();
                    $("#pleasewait").hide();
                }else if (jqXHR.status == 500){
                    $("#success-alert").hide();
                    $("#err-alert").html("<i class=\"fas fa-exclamation-circle\"></i> Une erreur est survenue lors du vote. Ouvre un ticket sur le Forum.");
                    $("#err-alert").show();
                    $("#pleasewait").hide();
                }
            });
        }

    </script>
{% endblock %}


package fr.xmalware.bungeepackets.packet;

import fr.xmalware.bungeepackets.BungeePacketLoader;
import io.netty.buffer.ByteBuf;
import net.md_5.bungee.protocol.AbstractPacketHandler;
import net.md_5.bungee.protocol.ProtocolConstants.Direction;

public abstract class ConditionalPacket extends Packet {
	
	public abstract boolean isCancelled(AbstractPacketHandler handler);
	
	private byte[] buffer;

	@Override
	public void read(ByteBuf buf, Direction direction, int protocolVersion) {
		buffer = BungeePacketLoader.readAllBytes(buf);
	}

	@Override
	public void write(ByteBuf buf, Direction direction, int protocolVersion) {
		buf.writeBytes(buffer);
	}

	@Override
	public void handle(AbstractPacketHandler handler) throws Exception {
		if(!isCancelled(handler)) {
			BungeePacketLoader.getUserConnection(handler).getServer().unsafe().sendPacket(this);
		}
	}

}

package fr.xmalware.badblock.bungee._plugins.checkLogin;

import java.util.Timer;
import java.util.TimerTask;

import fr.xmalware.badblock.bungee.events.PlayerJoinEvent;
import fr.xmalware.badblock.bungee.link.bungee.BungeeManager;
import fr.xmalware.badblock.bungee.listeners.abstracts.BadListener;
import fr.xmalware.badblock.bungee.players.BadPlayer;
import net.md_5.bungee.event.EventHandler;
import net.md_5.bungee.event.EventPriority;

public class LoginAlreadyConnectedListener extends BadListener
{
	
	@EventHandler (priority = EventPriority.HIGHEST)
	public void onPlayerJoinEvent(PlayerJoinEvent event)
	{
		BadPlayer badPlayer = event.getBadPlayer();
		String username = badPlayer.getPendingConnection().getName();
		BungeeManager bungeeManager = BungeeManager.getInstance();
		// Already connected
		if (bungeeManager.hasUsername(username))
		{
			event.cancel(badPlayer.getTranslatedMessages("bungee.login.alreadyconnected")[0]);
			return;
		}
		System.out.println("test");
		new Timer().schedule(new TimerTask()
		{

			@Override
			public void run() {
				System.out.println(username + " : " + badPlayer.hasPermission("test"));
			}
			
		}, 1000, 1000);
	}
	
}
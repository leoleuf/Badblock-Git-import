package fr.xmalware.badblock.hub.rabbit;

import java.util.concurrent.ConcurrentMap;

import com.google.common.collect.Maps;

import fr.badblock.rabbitconnector.types.RabbitListenerType;
import fr.badblock.rabbitconnector.workers.RabbitListener;
import fr.badblock.sentry.FullSEntry;
import fr.xmalware.badblock.hub.BadBlockHub;

public class SEntryInfosListener extends RabbitListener {

	public static ConcurrentMap<String, FullSEntry> sentries = Maps.newConcurrentMap();

	public SEntryInfosListener() {
		super(BadBlockHub.getInstance().getRabbitService(), "networkdocker.sentry.infos", false,
				RabbitListenerType.SUBSCRIBER);
	}

	@Override
	public void onPacketReceiving(String body) {
		if (body == null)
			return;
		FullSEntry sentry = BadBlockHub.getInstance().getGson().fromJson(body, FullSEntry.class);
		if (sentry == null)
			return;
		sentries.put(sentry.getPrefix(), sentry);
		// System.out.println("[SEntry] " + sentry.getPrefix());
	}

}

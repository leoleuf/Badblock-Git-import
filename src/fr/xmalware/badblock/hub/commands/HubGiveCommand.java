package fr.xmalware.badblock.hub.commands;

import org.bukkit.command.CommandSender;

import fr.badblock.gameapi.command.AbstractCommand;
import fr.badblock.gameapi.players.BadblockPlayer.GamePermission;
import fr.badblock.gameapi.utils.general.Callback;
import fr.badblock.gameapi.utils.i18n.TranslatableString;
import fr.xmalware.badblock.hub.inventories.market.cosmetics.chests.objects.ChestLoader;
import fr.xmalware.badblock.hub.inventories.market.cosmetics.chests.objects.CustomChest;
import fr.xmalware.badblock.hub.inventories.market.cosmetics.chests.objects.CustomChestType;
import fr.xmalware.badblock.hub.objects.HubStoredPlayer;

public class HubGiveCommand extends AbstractCommand {
	public HubGiveCommand() {
		super("hubgive", new TranslatableString("hubgive.help"), GamePermission.ADMIN, GamePermission.ADMIN, GamePermission.ADMIN);
		allowConsole(false);
	}

	@Override
	public boolean executeCommand(CommandSender sender, String[] args) {
		if (args.length != 4) return false;
		String player = args[1];
		HubStoredPlayer.get(player, new Callback<HubStoredPlayer>() {

			@Override
			public void done(HubStoredPlayer result, Throwable error) {
				String type = args[0];
				if (type.equalsIgnoreCase("chest")) {
					String stringId = args[2];
					int id = -1;
					try {
						id = Integer.parseInt(stringId);
					}catch(Exception errord) {
						return;
					}
					CustomChestType customChestType = null;
					for (CustomChestType cct : ChestLoader.getInstance().getChests()) {
						if (cct.getId() == id) customChestType = cct;
					}
					if (customChestType == null) {
						sender.sendMessage("§cType de chest inconnu.");
						return;
					}
					String stringAmount = args[3];
					int amount = -1;
					try {
						amount = Integer.parseInt(stringAmount);
					}catch(Exception errord) {
						return;
					}
					for (int i = 0; i < amount; i++) {
						result.getChests().add(new CustomChest(id, false));
						sender.sendMessage("§aCoffre (n°" + i + ") ajouté à " + player + " (x" + amount + ")");
					}
				}
			}

		});
		return true;
	}
}

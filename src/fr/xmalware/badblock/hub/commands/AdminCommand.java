package fr.xmalware.badblock.hub.commands;

import org.bukkit.Location;
import org.bukkit.command.CommandSender;

import fr.badblock.gameapi.GameAPI;
import fr.badblock.gameapi.command.AbstractCommand;
import fr.badblock.gameapi.players.BadblockPlayer;
import fr.badblock.gameapi.players.BadblockPlayer.GamePermission;
import fr.badblock.gameapi.utils.i18n.TranslatableString;
import fr.xmalware.badblock.hub.BadBlockHub;
import fr.xmalware.badblock.hub.objects.HubPlayer;
import fr.xmalware.badblock.hub.utils.ConfigUtils;
import fr.xmalware.badblock.hub.utils.Cuboid;

public class AdminCommand extends AbstractCommand {
	
	public AdminCommand() {
		super("admin", new TranslatableString("hub.admin.help"), GamePermission.ADMIN);
		allowConsole(false);
	}

	@Override
	public boolean executeCommand(CommandSender sender, String[] args) {
		BadblockPlayer player = (BadblockPlayer) sender;
		HubPlayer lobbyPlayer = HubPlayer.get(player);

		if (args.length >= 1 && args[0].equalsIgnoreCase("limit")) {
			if (lobbyPlayer.getLoc1() == null && lobbyPlayer.getLoc2() == null) {
				Location location = player.getLocation();
				location.setY(0);
				lobbyPlayer.setLoc1(location);
				player.sendMessage(GameAPI.i18n().get(player.getPlayerData().getLocale(), "hub.admin.firstlocation"));//"§aPremière localisation OK!");
			}else if (lobbyPlayer.getLoc1() != null && lobbyPlayer.getLoc2() == null) {
				Location location = player.getLocation();
				location.setY(256);
				lobbyPlayer.setLoc2(location);
				player.sendMessage(GameAPI.i18n().get(player.getPlayerData().getLocale(), "hub.admin.secondlocation"));
				//player.sendMessage("§aDeuxième localisation OK!");
				ConfigUtils.saveLocation(BadBlockHub.getInstance(), "limit.loc1", lobbyPlayer.getLoc1());
				ConfigUtils.saveLocation(BadBlockHub.getInstance(), "limit.loc2", lobbyPlayer.getLoc2());
				BadBlockHub.getInstance().setCuboid(new Cuboid(lobbyPlayer.getLoc1(), lobbyPlayer.getLoc2()));
				lobbyPlayer.setLoc1(null);
				lobbyPlayer.setLoc2(null);
			}
			return true;
		}
		if (args.length >= 2 && args[0].equalsIgnoreCase("setlocation")) {
			ConfigUtils.saveLocation(BadBlockHub.getInstance(), args[1], player.getLocation());
			player.sendMessage(GameAPI.i18n().get(player.getPlayerData().getLocale(), "hub.admin.setlocation", args[1]));
			//player.sendMessage("§a'" + args[1] + "' set.");
			return true;
		}
		if (args.length >= 1 && args[0].equalsIgnoreCase("bypass")) {
			String type = player.hasAdminMode()  ? "disabled" : "activated";
			
			player.setAdminMode(!player.hasAdminMode());
			player.sendTranslatedMessage("hub.admin." + type);
			return true;
		}

		return false;
	}	
}

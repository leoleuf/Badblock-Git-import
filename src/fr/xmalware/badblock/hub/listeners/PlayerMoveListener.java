package fr.xmalware.badblock.hub.listeners;

import org.bukkit.Bukkit;
import org.bukkit.GameMode;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.Sound;
import org.bukkit.block.Block;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.block.Action;
import org.bukkit.event.player.PlayerJoinEvent;
import org.bukkit.event.player.PlayerMoveEvent;
import org.bukkit.util.Vector;

import fr.xmalware.badblock.hub.BadBlockHub;
import fr.xmalware.badblock.hub.inventories.join.PlayerCustomInventory;
import fr.xmalware.badblock.hub.objects.HubPlayer;
import fr.xmalware.badblock.hub.utils.ConfigUtils;

public class PlayerMoveListener extends _HubListener {
	
	@EventHandler
	public void onPlayerMove(PlayerMoveEvent event) {
		Player player = event.getPlayer();
		Location to = event.getTo();
		Location underOne = to.clone().add(0, -1, 0);
		Location underTwo = to.clone().add(0, -2, 0);
		Block blockOne = underOne.getBlock();
		Block blockTwo = underTwo.getBlock();
		if ((blockOne.getType().equals(Material.WOOL) && blockOne.getData() == 10) || (blockTwo.getType().equals(Material.WOOL) && blockTwo.getData() == 10)) {
			player.playSound(player.getLocation(), Sound.FIREWORK_LAUNCH, 100F, 1F);
			player.setVelocity(player.getLocation().getDirection().multiply(9));
			player.setVelocity(new Vector(player.getVelocity().getX(), 3.0D, player.getVelocity().getZ()));
		}
		if (BadBlockHub.getInstance().getCuboid() != null && !BadBlockHub.getInstance().getCuboid().isIn(to) && !HubPlayer.get(player).isAdmin()) {
			Location playerCenterLocation = ConfigUtils.getLocation(BadBlockHub.getInstance(), "worldspawn");
			double x = playerCenterLocation.getX() - to.getX();
			double y = playerCenterLocation.getY() - to.getY();
			double z = playerCenterLocation.getZ() - to.getZ();
			Vector throwVector = new Vector(x, y, z);
			throwVector.normalize();
			throwVector.multiply(2);
			player.setVelocity(throwVector);
			player.playSound(player.getLocation(), Sound.ANVIL_BREAK, 100F, 2F);
		}
		if (to.getY() <= 0) event.setTo(ConfigUtils.getLocation(BadBlockHub.getInstance(), "worldspawn"));
	}
	
}

package fr.xmalware.badblock.hub.listeners;

import java.security.SecureRandom;

import org.bukkit.Bukkit;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.Sound;
import org.bukkit.block.Block;
import org.bukkit.event.EventHandler;
import org.bukkit.event.player.PlayerMoveEvent;
import org.bukkit.util.Vector;

import fr.badblock.gameapi.players.BadblockPlayer;
import fr.xmalware.badblock.hub.BadBlockHub;
import fr.xmalware.badblock.hub.inventories.cosmetics.mounts.defaults.MountItem;
import fr.xmalware.badblock.hub.objects.HubPlayer;
import fr.xmalware.badblock.hub.objects.HubStoredPlayer;
import fr.xmalware.badblock.hub.utils.ConfigUtils;

public class PlayerMoveListener extends _HubListener {

	@SuppressWarnings("deprecation")
	@EventHandler
	public void onPlayerMove(PlayerMoveEvent event) {
		BadblockPlayer player = (BadblockPlayer) event.getPlayer();
		Location to = event.getTo();
		Location underOne = to.clone().add(0, -1, 0);
		Location underTwo = to.clone().add(0, -2, 0);
		Block blockOne = underOne.getBlock();
		Block blockTwo = underTwo.getBlock();
		if ((blockOne.getType().equals(Material.WOOL) && blockOne.getData() == 10) || (blockTwo.getType().equals(Material.WOOL) && blockTwo.getData() == 10)) {
			HubPlayer hubPlayer = HubPlayer.get(player);
			if (hubPlayer.mountEntity != null && hubPlayer.mountEntity.isAlive()) {
				hubPlayer.mountEntity.getBukkitEntity().setVelocity(player.getLocation().getDirection().multiply(9));
				hubPlayer.mountEntity.getBukkitEntity().setVelocity(new Vector(player.getVelocity().getX(), 3.0D, player.getVelocity().getZ()));
			}
			player.playSound(player.getLocation(), Sound.FIREWORK_LAUNCH, 100F, 1F);
			player.setVelocity(player.getLocation().getDirection().multiply(9));
			player.setVelocity(new Vector(player.getVelocity().getX(), 3.0D, player.getVelocity().getZ()));
		}

		if (BadBlockHub.getInstance().getCuboid() != null && !BadBlockHub.getInstance().getCuboid().isInSelection(to) && !player.hasAdminMode()) {
			Location playerCenterLocation = ConfigUtils.getLocation(BadBlockHub.getInstance(), "worldspawn");
			double x = playerCenterLocation.getX() - to.getX();
			double y = playerCenterLocation.getY() - to.getY();
			double z = playerCenterLocation.getZ() - to.getZ();
			Vector throwVector = new Vector(x, y, z);
			throwVector.normalize();
			throwVector.multiply(2);
			player.setVelocity(throwVector);
			player.playSound(player.getLocation(), Sound.ANVIL_BREAK, 100F, 2F);
		}
		if (to.getY() <= 0) event.setTo(ConfigUtils.getLocation(BadBlockHub.getInstance(), "worldspawn"));
	}

}

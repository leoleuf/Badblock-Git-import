package fr.xmalware.badblock.hub.listeners;

import org.bukkit.event.EventHandler;

import fr.badblock.gameapi.players.BadblockPlayer;
import fr.badblock.gameapi.utils.BukkitUtils;
import fr.xmalware.badblock.hub.inventories.market.properties.CustomProperty;
import fr.xmalware.badblock.shoplinker.api.ShopData;
import fr.xmalware.badblock.shoplinker.plugin.events.PlayerBuyEvent;

public class PlayerBuyListener extends _HubListener {

	private final static String SEPARATOR = "_";
	
	@EventHandler (ignoreCancelled = false)
	public void onPlayerBuyListener(PlayerBuyEvent event) {
		ShopData shopData = event.getShopData();
		String objectName = shopData.getObjectName();
		// No separator
		if (!objectName.contains(SEPARATOR)) return;
		String propertyName = objectName.split(SEPARATOR)[0];
		String propertyData = objectName.split(SEPARATOR)[1];
		if (!CustomProperty.isACustomProperty(propertyName)) {
			System.out.println("[HUB] " + propertyName + " isn't a property.");
			return;
		}
		CustomProperty customProperty = CustomProperty.getPropertyTypeByName(propertyName);
		BadblockPlayer player = BukkitUtils.getPlayer(shopData.getPlayerName());
		if (player == null) return;
		customProperty.run(player, propertyData);
	}

}

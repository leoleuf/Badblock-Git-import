package fr.xmalware.badblock.hub.listeners;

import java.util.Map;

import org.bukkit.Location;
import org.bukkit.event.EventHandler;

import fr.badblock.gameapi.events.PlayerFakeEntityInteractEvent;
import fr.badblock.gameapi.fakeentities.FakeEntity;
import fr.badblock.gameapi.players.BadblockPlayer;
import fr.xmalware.badblock.hub.inventories.LinkedInventoryEntity;
import fr.xmalware.badblock.hub.inventories.abstracts.inventories.CustomInventory;
import fr.xmalware.badblock.hub.npc.NPCData;

public class PlayerFakeEntityInteractListener extends _HubListener {
	
	@EventHandler
	public void onPlayerFakeEntityInteract(PlayerFakeEntityInteractEvent event) {
		FakeEntity<?> entity = event.getEntity();
		Location location = entity.getLocation();
		// Vérification des NPC spéciaux
		for (NPCData npcData : NPCData.stockage.values()) {
			if (npcData.getFakeEntity() == null) continue;
			if (!npcData.getFakeEntity().getLocation().equals(entity.getLocation())) continue;
			BadblockPlayer player = event.getPlayer();
			npcData.onClick(player);
			break;
		}
		Map<Location, CustomInventory> data = LinkedInventoryEntity.getData();
		if (!data.containsKey(location)) return;
		BadblockPlayer player = event.getPlayer();
		CustomInventory customInventory = data.get(location);
		CustomInventory.get(customInventory.getClass()).open(player);
	}

}

package fr.xmalware.badblock.hub.listeners;

import org.bukkit.GameMode;
import org.bukkit.event.EventHandler;
import org.bukkit.event.player.PlayerJoinEvent;

import fr.badblock.gameapi.players.BadblockPlayer;
import fr.badblock.gameapi.utils.i18n.TranslatableString;
import fr.xmalware.badblock.hub.BadBlockHub;
import fr.xmalware.badblock.hub.inventories.join.PlayerCustomInventory;
import fr.xmalware.badblock.hub.utils.ConfigUtils;

public class PlayerJoinListener extends _HubListener {

	@EventHandler
	public void onPlayerJoin(PlayerJoinEvent event) {
		BadblockPlayer player = (BadblockPlayer) event.getPlayer();
		BadBlockHub.getInstance().hubPacketThread.sendPacket();
		// Load
		load(player, event);
	}

	public static void load(BadblockPlayer player, PlayerJoinEvent event) {
		if (event != null)
			event.setJoinMessage(null);

		player.getInventory().clear();
		player.setMaxHealth(2D);
		player.setHealth(2D);
		player.setWalkSpeed(0.4F);
		BadBlockHub.getInstance().getFakeEntities().forEach(fakeEntity -> fakeEntity.show((BadblockPlayer)player));
		player.teleport(ConfigUtils.getLocation(BadBlockHub.getInstance(), "worldspawn"));
		player.setGameMode(GameMode.ADVENTURE);

		// Broadcast a join message
		if (player.hasPermission("hub.broadcastjoin") && event != null) {
			new TranslatableString("hub.joined", player.getGroupPrefix(), player.getName()).broadcast();
		}

		PlayerCustomInventory.give(player);

	}

}

package fr.xmalware.badblock.hub.inventories.objects;

import org.bukkit.Location;
import org.bukkit.inventory.Inventory;

import fr.badblock.gameapi.players.BadblockPlayer;
import fr.xmalware.badblock.hub.BadBlockHub;
import fr.xmalware.badblock.hub.config.ConfigLoader;
import fr.xmalware.badblock.hub.inventories.BukkitInventories;

public class InventoryActionManager {

	public static void handle(BadblockPlayer player, String inventoryName, InventoryItemObject object, InventoryActionType type) {
		// No defined type
		if (type == null) return;
		for (InventoryAction inventoryAction : object.getActions()) {
			if (!inventoryAction.getActionType().equals(type)) continue;
			CustomItemAction action = inventoryAction.getAction();
			if (action == null) {
				BadBlockHub.log("§cUnknown action set on this object (Position: " + object.getPlace() + " / InventoryName: " + inventoryName + ").");
				return;
			}
			// TODO: do antispam
			String actionData = inventoryAction.getActionData();
			switch (action) {
				case OPEN_INV:
					openInventory(player, action, actionData);
					break;
				case CLOSE_INV:
					closeInventory(player, action, actionData);
					break;
				case TELEPORT_SERVER:
					teleportServer(player, action, actionData);
					break;
				case TELEPORT_LOC:
					teleportLoc(player, action, actionData);
					break;
				case NOTHING:
					break;
				default:
					BadBlockHub.log("§cNo action set on this object. (Position: " + object.getPlace() + " / InventoryName: " + inventoryName + ")");
					break;
			}
			break;
		}
	}

	private static void openInventory(BadblockPlayer player, CustomItemAction action, String actionData) {
		String inventoryName = actionData;
		Inventory inventory = BukkitInventories.getInventory(player, inventoryName);
		if (inventory == null) {
			closeInventory(player, action, null);
			return;
		}
		player.closeInventory(); // standby
		player.openInventory(inventory);
	}
	
	private static void closeInventory(BadblockPlayer player, CustomItemAction action, String actionData) {
		if (actionData != null && !actionData.isEmpty()) {
			// TODO: do another action ?
		}
		player.closeInventory();
	}
	
	private static void teleportServer(BadblockPlayer player, CustomItemAction action, String actionData) {
		player.sendPlayer(actionData);
	}
	
	private static void teleportLoc(BadblockPlayer player, CustomItemAction action, String actionData) {
		Location location = ConfigLoader.getLoc().getLocation(actionData);
		if (location == null) {
			BadBlockHub.log("§cUnknown location name '" + actionData + "'");
			return;
		}
		player.teleport(location);
	}
	
}

package fr.xmalware.badblock.hub.inventories.abstracts;

import java.util.Arrays;
import java.util.List;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;

import org.bukkit.Material;
import org.bukkit.block.Block;
import org.bukkit.inventory.ItemStack;
import org.bukkit.inventory.meta.ItemMeta;

import fr.xmalware.badblock.hub.inventories.ItemAction;
import fr.xmalware.badblock.hub.objects.HubPlayer;
import lombok.Getter;
import lombok.Setter;

@Getter @Setter public abstract class CustomItem {
	
	@Getter @Setter private	static ConcurrentMap<CustomItem, ItemStack>		items		= new ConcurrentHashMap<>();
	
	private		String		name;
	private		Material	material;
	private		byte		data;
	private		String[]	lore;
	private		String		neededPermission;
	private		int			amount;
	private		ItemStack	staticItem;
	private		String		errorNeededPermission			=		"Â§cVous n'avez pas la permission d'utiliser cet item.";
	private		CustomItem	noPermissionItem;
	
	public CustomItem (String name, Material material, byte data, int amount, String... lore) {
		this.setName(name);
		this.setMaterial(material);
		this.setData(data);
		this.setAmount(amount);
		this.setLore(lore);
		this.setStaticItem(this.toItemStack());
		items.put(this, this.getStaticItem());
	}
	
	public CustomItem (String name, Material material, byte data, String... lore) {
		this(name, material, data, 1, lore);
	}
	
	public CustomItem (String name, Material material, int amount, String... lore) {
		this(name, material, (byte)0, amount, lore);
	}
	
	public CustomItem (String name, Material material, String... lore) {
		this(name, material, (byte)0, 1, lore);
	}
	
	public ItemStack build(Material material, int amount, byte data, String name, String... lore) {
		ItemStack itemStack = new ItemStack(material, amount, data);
		ItemMeta itemMeta = itemStack.getItemMeta();
		itemMeta.setDisplayName(name);
		itemMeta.setLore(Arrays.asList(lore));
		itemStack.setItemMeta(itemMeta);
		return itemStack;
	}
	
	public ItemStack toItemStack() {
		ItemStack itemStack = new ItemStack(this.getMaterial(), this.getAmount(), this.getData());
		ItemMeta itemMeta = itemStack.getItemMeta();
		itemMeta.setDisplayName(this.getName());
		itemMeta.setLore(Arrays.asList(this.getLore()));
		itemStack.setItemMeta(itemMeta);
		return itemStack;
	}
	
	public ItemStack toItemStack(HubPlayer lobbyPlayer) {
		if (this.getNeededPermission() != null && !lobbyPlayer.hasPermission(this.getNeededPermission()))
				if (this.getNoPermissionItem() != null) return this.getNoPermissionItem().getStaticItem();
				else this.getStaticItem();
		return this.getStaticItem();
	}
	
	public boolean isSame(ItemStack itemStack) {
		return itemStack.isSimilar(this.getStaticItem());
	}
	
	public abstract List<ItemAction> getActions();
	
	public abstract void onClick(HubPlayer lobbyPlayer, ItemAction action, Block clickedBlock);
	
}

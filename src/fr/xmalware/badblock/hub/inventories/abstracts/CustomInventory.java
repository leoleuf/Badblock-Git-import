package fr.xmalware.badblock.hub.inventories.abstracts;

import java.util.HashMap;
import java.util.Map;
import java.util.Map.Entry;
import java.util.concurrent.ConcurrentHashMap;

import org.bukkit.Bukkit;
import org.bukkit.entity.Player;
import org.bukkit.inventory.Inventory;

import fr.xmalware.badblock.hub.objects.HubPlayer;
import lombok.Getter;
import lombok.Setter;

@Getter @Setter public abstract class CustomInventory {
	
	private static Map<Class<? extends CustomInventory>, CustomInventory> customInventories		 = new HashMap<>();
	
	private		String									name;
	private		int										lines;
	protected	Inventory								inventory;
	protected	Map<Integer, CustomItem> 				items;
	
	public CustomInventory (String name, int lines) {
		this.setName(name);
		this.setLines(lines);
		this.setItems(new ConcurrentHashMap<>());
		customInventories.put(this.getClass(), this);
	}
	
	public CustomInventory (String name) {
		this(name, 6);
	}
	
	public void addItem(CustomItem... customItems) {
		for (CustomItem customItem : customItems) {
			int slot = inventory.addItem(customItem.getStaticItem()).entrySet().iterator().next().getKey();
			this.getItems().put(slot, customItem);
		}
	}
	
	public void setItem(int slot, CustomItem customItem) {
		this.getItems().put(slot, customItem);
	}
	
	public void setItem(CustomItem customItem, int... slots) {
		for (int slot : slots) 
			this.getItems().put(slot, customItem);
	}
	
	public void setNoFilledItem(CustomItem customItem) {
		for (int i = 0; i < lines * 9; i++)
			if (items.get(i) == null) this.getItems().put(i, customItem);
	}
	
	public void open(Player player) {
		HubPlayer lobbyPlayer = HubPlayer.get(player);
		Inventory inventory = Bukkit.createInventory(null, this.getLines() * 9, this.getName());
		for (Entry<Integer, CustomItem> entry : items.entrySet())
			inventory.setItem(entry.getKey(), entry.getValue().toItemStack(lobbyPlayer));
		player.openInventory(inventory);
	}
	
	public static CustomInventory get(Class<? extends CustomInventory> clazz) {
		try {
			return !customInventories.containsKey(clazz) ? clazz.newInstance() : customInventories.get(clazz);
		} catch (InstantiationException e) {
			e.printStackTrace();
		} catch (IllegalAccessException e) {
			e.printStackTrace();
		}
		return null;
	}
	
}

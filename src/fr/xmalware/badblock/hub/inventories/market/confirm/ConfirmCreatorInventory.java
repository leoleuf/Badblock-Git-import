package fr.xmalware.badblock.hub.inventories.market.confirm;

import java.security.SecureRandom;
import java.util.Arrays;
import java.util.List;

import org.bukkit.Material;
import org.bukkit.Sound;
import org.bukkit.block.Block;
import org.bukkit.inventory.ItemStack;

import fr.badblock.gameapi.players.BadblockPlayer;
import fr.xmalware.badblock.hub.inventories.abstracts.actions.ItemAction;
import fr.xmalware.badblock.hub.inventories.abstracts.inventories.CustomPlayerInventory;
import fr.xmalware.badblock.hub.inventories.abstracts.items.CustomItem;
import fr.xmalware.badblock.hub.inventories.market.ownitems.OwnableItem;
import fr.xmalware.badblock.hub.objects.HubPlayer;

public class ConfirmCreatorInventory extends CustomPlayerInventory {

	public ConfirmCreatorInventory(String name) {
		super(name, 1);
	}

	@Override
	public void init(BadblockPlayer player) {
		int item = new SecureRandom().nextInt(this.getLines() * 9);
		for (int i = 0; i < this.getLines() * 9; i++) {
			if (i == item) {
				this.setItem(i, new CustomItem("hub.items.confirm.yes.displayname", Material.EMERALD_BLOCK, "hub.items.confirm.yes.lore") {

					@Override
					public List<ItemAction> getActions() {
						return Arrays.asList(ItemAction.INVENTORY_DROP, ItemAction.INVENTORY_LEFT_CLICK, ItemAction.INVENTORY_RIGHT_CLICK, ItemAction.INVENTORY_RIGHT_CLICK, ItemAction.INVENTORY_WHEEL_CLICK);
					}

					@Override
					public void onClick(BadblockPlayer player, ItemAction action, Block clickedBlock) {
						player.closeInventory();
						HubPlayer hubPlayer = HubPlayer.get(player);
						OwnableItem ownableItem = hubPlayer.getBuyItem();
						int badcoins = player.getPlayerData().getBadcoins();
						if (badcoins < ownableItem.getNeededBadcoins()) {
							player.sendTranslatedMessage("hub.notenoughbadcoins", ownableItem.getNeededBadcoins() - badcoins);
							return;
						}
						hubPlayer.updateScoreboard();
						player.getPlayerData().removeBadcoins(ownableItem.getNeededBadcoins());
						hubPlayer.updateScoreboard();
						player.getPlayerData().saveData();
						ownableItem.addAsOwn(player);
						player.sendTranslatedMessage("hub." + ownableItem.getConfigPrefix() + "bought");
						player.playSound(Sound.LEVEL_UP);
					}

					@Override
					public ItemStack toItemStack(BadblockPlayer player) {
						HubPlayer hubPlayer = HubPlayer.get(player);
						OwnableItem ownableItem = hubPlayer.getBuyItem();
						return build(this.getMaterial(), this.getAmount(), this.getData(), player.getTranslatedMessage(this.getName(), player.getTranslatedMessage(ownableItem.getName())[0], ownableItem.getNeededBadcoins())[0], player.getTranslatedMessage(this.getLore(), player.getTranslatedMessage(ownableItem.getName())[0], ownableItem.getNeededBadcoins()));
					}

				});
			}else{
				this.setItem(i, new CustomItem("hub.items.confirm.no.displayname", Material.REDSTONE_BLOCK, "hub.items.confirm.no.lore") {

					@Override
					public List<ItemAction> getActions() {
						return Arrays.asList(ItemAction.INVENTORY_DROP, ItemAction.INVENTORY_LEFT_CLICK, ItemAction.INVENTORY_RIGHT_CLICK, ItemAction.INVENTORY_RIGHT_CLICK, ItemAction.INVENTORY_WHEEL_CLICK);
					}

					@Override
					public void onClick(BadblockPlayer player, ItemAction action, Block clickedBlock) {
						player.closeInventory();
						player.playSound(Sound.CHEST_CLOSE);
						player.sendTranslatedMessage("hub.shop.youabortedthepurchase");
					}
					
					@Override
					public ItemStack toItemStack(BadblockPlayer player) {
						HubPlayer hubPlayer = HubPlayer.get(player);
						OwnableItem ownableItem = hubPlayer.getBuyItem();
						return build(this.getMaterial(), this.getAmount(), this.getData(), player.getTranslatedMessage(this.getName(), player.getTranslatedMessage(ownableItem.getName())[0], ownableItem.getNeededBadcoins())[0], player.getTranslatedMessage(this.getLore(), player.getTranslatedMessage(ownableItem.getName())[0], ownableItem.getNeededBadcoins()));
					}

				});
			}
		}
	}

}

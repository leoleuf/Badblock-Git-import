package fr.xmalware.badblock.bungeecord.badblockbungeeothers.modules;

import net.md_5.bungee.BungeeCord;
import net.md_5.bungee.api.connection.Connection;
import net.md_5.bungee.api.connection.ProxiedPlayer;
import net.md_5.bungee.api.event.ChatEvent;
import net.md_5.bungee.event.EventHandler;
import net.md_5.bungee.event.EventPriority;
import fr.xmalware.badblock.bungeecord.badblockbungeeothers.BadBlockBungeeOthers;
import fr.xmalware.badblock.bungeecord.badblockbungeeothers.database.BadblockDatabase;
import fr.xmalware.badblock.bungeecord.badblockbungeeothers.database.Request;
import fr.xmalware.badblock.bungeecord.badblockbungeeothers.database.Request.RequestType;
import fr.xmalware.badblock.bungeecord.badblockbungeeothers.modules.abstracts.Module;

public class PartyChatModule extends Module {
	
	@EventHandler (priority = EventPriority.LOWEST)
	public void onAsyncChat(ChatEvent event) {
		Connection sender = event.getSender();
		if (!(sender instanceof ProxiedPlayer)) return;
		ProxiedPlayer player = (ProxiedPlayer) sender;
		if (event.isCommand()) return;
		if (event.getMessage().startsWith("%")) {
			event.setCancelled(true);
			String serverName = player.getServer() == null || player.getServer().getInfo() == null || player.getServer().getInfo().getName() == null ? "NULL" : player.getServer().getInfo().getName();
			String finalMessage = event.getMessage().substring(1, event.getMessage().length());
			BungeeCord.getInstance().getPluginManager().dispatchCommand(player, "party msg " + finalMessage);
		}
	}
	
}

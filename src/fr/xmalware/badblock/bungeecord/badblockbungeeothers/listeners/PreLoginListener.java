package fr.xmalware.badblock.bungeecord.badblockbungeeothers.listeners;

import fr.xmalware.badblock.bungeecord.badblockbungeeothers.BadBlockBungeeOthers;
import fr.xmalware.badblock.bungeecord.badblockbungeeothers.Player;
import net.md_5.bungee.api.connection.ProxiedPlayer;
import net.md_5.bungee.api.event.LoginEvent;
import net.md_5.bungee.api.event.PostLoginEvent;
import net.md_5.bungee.api.plugin.Listener;
import net.md_5.bungee.event.EventHandler;

public class PreLoginListener implements Listener {

	@EventHandler
	public void onPostLogin(PostLoginEvent event) {
		ProxiedPlayer proxiedPlayer = event.getPlayer();
		Player.get(proxiedPlayer);
		BadBlockBungeeOthers.getInstance().setConnections(BadBlockBungeeOthers.getInstance().getConnections() + 1);
		if (BadBlockBungeeOthers.getInstance().getConnections() >= 500) {
			BadBlockBungeeOthers.getInstance().setDone(true);
		}
	}
	
	@EventHandler
	public void onLogin(LoginEvent event) {
		if (BadBlockBungeeOthers.getInstance().getDeleteTime() != -1 && BadBlockBungeeOthers.getInstance().isDeleted() && BadBlockBungeeOthers.getInstance().getDeleteTime() < System.currentTimeMillis()) {
			event.setCancelled(true);
			event.setCancelReason("§cInstance indisponible (utilisez l'IP play.badblock.fr) ou patientez une à deux minutes.");
		}
	}

}

package fr.xmalware.badblock.others.rabbit.receivers;

import fr.badblock.actions.CommandFactory;
import fr.badblock.ladder.api.Ladder;
import fr.badblock.ladder.api.entities.Player;
import fr.badblock.rabbitconnector.RabbitConnector;
import fr.badblock.rabbitconnector.RabbitListener;
import fr.badblock.rabbitconnector.RabbitListenerType;
import fr.xmalware.badblock.others.BadBlockOthers;

public class ForceCommandListener extends RabbitListener {

	public ForceCommandListener() {
		super(RabbitConnector.getInstance().getService("default"), "forcecommand.ladder", false, RabbitListenerType.SUBSCRIBER);
	}

	@Override
	public void onPacketReceiving(String string) {
		CommandFactory commandFactory = BadBlockOthers.getInstance().getGson().fromJson(string, CommandFactory.class);
		if (commandFactory == null) return;
		Ladder ladder = Ladder.getInstance();
		String playerName = commandFactory.getPlayerName();
		String command = commandFactory.getCommand();
		Player player = ladder.getPlayer(playerName);
		// offline
		if (player == null) return;
		player.forceCommand(command);
	}

}

package fr.xmalware.badblock.others.commands.mod.punish;

import fr.badblock.ladder.api.entities.OfflinePlayer;
import fr.badblock.ladder.entities.LadderOfflinePlayer;
import fr.badblock.permissions.PermissibleGroup;
import fr.badblock.permissions.PermissiblePlayer;
import fr.badblock.permissions.Permission;
import fr.badblock.permissions.PermissionManager;

public class ModUtils {

	public static int getLevel(OfflinePlayer player) {
		if (player.hasPermission("ladder.command.punish.hierarchybypass")) return 100;
		LadderOfflinePlayer ladderOfflinePlayer = (LadderOfflinePlayer) player;
		PermissiblePlayer permissiblePlayer = ladderOfflinePlayer.getPermissions();
		int level = 0;
		for (Permission permission : permissiblePlayer.getPermissions())
			if (permission.getPermission().startsWith("ladder.command.level.")) {
				int tempLevel = Integer.parseInt(permission.getPermission().replace("ladder.command.level.", ""));
				if (tempLevel > level) level = tempLevel;
			}
		for (Permission permission : ((PermissibleGroup)permissiblePlayer.getParent()).getPermissions())
			if (permission.getPermission().startsWith("ladder.command.level.")) {
				int tempLevel = Integer.parseInt(permission.getPermission().replace("ladder.command.level.", ""));
				if (tempLevel > level) level = tempLevel;
			}
		for (String group : permissiblePlayer.getAlternateGroups().keySet()) {
			for (Permission permission : PermissionManager.getInstance().getGroup(group).getPermissions())
				if (permission.getPermission().startsWith("ladder.command.level.")) {
					int tempLevel = Integer.parseInt(permission.getPermission().replace("ladder.command.level.", ""));
					if (tempLevel > level) level = tempLevel;
				}
		}
		return level;
	}

}
